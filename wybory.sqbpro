<?xml version="1.0" encoding="UTF-8"?><sqlb_project><db path="wybory.sqbpro.db" readonly="0" foreign_keys="1" case_sensitive_like="0" temp_store="0" wal_autocheckpoint="1000" synchronous="2"/><attached/><window><main_tabs open="structure browser pragmas query" current="3"/></window><tab_structure><column_width id="0" width="300"/><column_width id="1" width="0"/><column_width id="2" width="100"/><column_width id="3" width="915"/><column_width id="4" width="0"/><expanded_item id="0" parent="1"/><expanded_item id="1" parent="1"/><expanded_item id="2" parent="1"/><expanded_item id="3" parent="1"/></tab_structure><tab_browse><table title=".Browsables" custom_title="0" dock_id="1" table="0,10:Browsables"/><dock_state state="000000ff00000000fd00000001000000020000052b00000780fc0100000001fb000000160064006f0063006b00420072006f007700730065003101000000000000052b0000015c00ffffff0000052b0000000000000004000000040000000800000008fc00000000"/><default_encoding codec=""/><browse_table_settings><table schema="main" name="protokoly_1" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_" freeze_columns="0"><sort/><column_widths><column index="1" value="75"/><column index="2" value="130"/><column index="3" value="56"/><column index="4" value="89"/><column index="5" value="57"/><column index="6" value="97"/><column index="7" value="300"/><column index="8" value="192"/><column index="9" value="89"/><column index="10" value="173"/><column index="11" value="120"/><column index="12" value="214"/><column index="13" value="153"/><column index="14" value="188"/><column index="15" value="245"/><column index="16" value="223"/><column index="17" value="222"/><column index="18" value="173"/><column index="19" value="238"/><column index="20" value="300"/><column index="21" value="300"/><column index="22" value="300"/><column index="23" value="300"/><column index="24" value="146"/><column index="25" value="300"/><column index="26" value="165"/><column index="27" value="144"/><column index="28" value="111"/><column index="29" value="85"/><column index="30" value="83"/><column index="31" value="300"/><column index="32" value="300"/><column index="33" value="95"/><column index="34" value="45"/><column index="35" value="46"/><column index="36" value="66"/><column index="37" value="63"/><column index="38" value="55"/><column index="39" value="65"/><column index="40" value="67"/><column index="41" value="69"/><column index="42" value="74"/><column index="43" value="86"/><column index="44" value="43"/><column index="45" value="70"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table></browse_table_settings></tab_browse><tab_sql><sql name="SQL 1*">drop table protokoly_1_2;
create table protokoly_1_2 as 

select a.nr_komisji||'_'||a.gmina||'_'||a.siedziba as komisja,
			a.liczba_wyborcow_wydanych_lacznie as wyborcy_1,
			b.liczba_wyborcow_wydanych_lacznie as wyborcy_2,
			a.nawrocki as nawrocki_1,
			b.nawrocki as nawrocki_2,
			a.trzaskowski as trzaskowski_1,
			b.trzaskowski as trzaskowski_2,
			a.bartoszewicz,
			a.biejat,
			a.braun,
			a.holownia,
			a.jakubiak,
			a.maciak,
			a.mentzen, 
			a.senyszyn,
			a.stanowski,
			a.woch,
			a.zandberg
			
			
from protokoly_1 a inner join protokoly_2 b on a.nr_komisji=b.nr_komisji and a.siedziba=b.siedziba;

drop table komisje_wyniki_sim;

/* przeplywy wyborc√≥w z exit poll */

create table komisje_wyniki_sim as 
select komisja, 
			nawrocki_1, nawrocki_2, 
			0.5*bartoszewicz+0.1*biejat+0.92*braun+0.14*holownia+0.8*jakubiak+0.5*maciak+0.88*mentzen+0.19*senyszyn+0.51*stanowski+0.8*woch+0.16*zandberg +nawrocki_1 as nawrocki_przeplywy_2,
			trzaskowski_1, trzaskowski_2, 
			0.5*bartoszewicz+0.9*biejat+0.08*braun+0.86*holownia+0.2*jakubiak+0.5*maciak+0.12*mentzen+0.81*senyszyn+0.49*stanowski+0.2*woch+0.84*zandberg +trzaskowski_1 as trzaskowski_przeplywy_2,
			wyborcy_2-wyborcy_1 as nowi_wyborcy,
			0.5*bartoszewicz+0.1*biejat+0.92*braun+0.14*holownia+0.8*jakubiak+0.5*maciak+0.88*mentzen+0.19*senyszyn+0.51*stanowski+0.8*woch+0.16*zandberg +nawrocki_1+0.45*(wyborcy_2-wyborcy_1) as nawrocki_przeplywy_2_n,
			0.5*bartoszewicz+0.9*biejat+0.08*braun+0.86*holownia+0.2*jakubiak+0.5*maciak+0.12*mentzen+0.81*senyszyn+0.49*stanowski+0.2*woch+0.84*zandberg +trzaskowski_1+0.55*(wyborcy_2-wyborcy_1) as trzaskowski_przeplywy_2_n
			
from protokoly_1_2;

select *
--sum(nawrocki_2), sum(trzaskowski_2), sum(nawrocki_przeplywy_2), sum(trzaskowski_przeplywy_2)
from komisje_wyniki_sim; -- bez glosow nowych wyborcow

select *from komisje_wyniki_sim
where 1=1
--and trzaskowski_1&gt;trzaskowski_2 and nawrocki_1&lt;nawrocki_2
and abs(nawrocki_przeplywy_2_n-trzaskowski_2)&lt;abs(trzaskowski_przeplywy_2_n-nawrocki_2)
order by trzaskowski_1 desc;



select *from komisje_wyniki_sim
where 1=1
and abs(nawrocki_przeplywy_2_n-trzaskowski_2)&lt;abs(trzaskowski_przeplywy_2_n-nawrocki_2)
order by trzaskowski_1 desc;
---------------------------------------------------------------------------------

select 
  komisja,
  nawrocki_1,  nawrocki_2,
  trzaskowski_1,trzaskowski_2,
  nawrocki_przeplywy_2_n,
  trzaskowski_przeplywy_2_n,
  case
    when 
      abs(nawrocki_przeplywy_2_n - trzaskowski_2) &lt; abs(nawrocki_przeplywy_2_n - nawrocki_2)
      and
      abs(trzaskowski_przeplywy_2_n - nawrocki_2) &lt; abs(trzaskowski_przeplywy_2_n - trzaskowski_2)
    then 'TAK'
    else 'NIE'
  end as podejrzenie_zamiany,
  case
  when
    abs(nawrocki_przeplywy_2_n - trzaskowski_2) &lt; abs(nawrocki_przeplywy_2_n - nawrocki_2)
    AND
    abs(trzaskowski_przeplywy_2_n - nawrocki_2) &lt; abs(trzaskowski_przeplywy_2_n - trzaskowski_2)
  then
    case
      when nawrocki_2 &lt; trzaskowski_2 then 'Trzaskowski'
      else 'Nawrocki'
    end
 else null
end as zamiana_na_korzysc
from komisje_wyniki_sim
where (
    abs(nawrocki_przeplywy_2_n - nawrocki_2) &gt; nawrocki_2 *0.25
    and
    abs(trzaskowski_przeplywy_2_n - trzaskowski_2) &gt; trzaskowski_2 *0.25
  )
and (nawrocki_2&gt;30 and trzaskowski_2&gt;30)
and podejrzenie_zamiany='TAK'
order by zamiana_na_korzysc asc;
</sql><current_tab id="0"/></tab_sql></sqlb_project>
